{% extends "base.html" %}

{% block title %}
  {% if current_user.language == 'russian' %}
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
  {% else %}
    Create a New Course
  {% endif %}
{% endblock %}

{% block content %}
{% set lang = current_user.language %}

<link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
<link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}">

<style>
  body {
    background-color: #22303C;
    font-family: 'Inter', sans-serif;
  }

  .container {
    background: #344955;
    border-radius: 16px;
    padding: 30px;
    max-width: 680px;
    margin: 40px auto;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    animation: fadeIn 0.8s ease-in-out;
  }

  h1 {
    text-align: center;
    color: #F0F0F0;
    font-weight: 800;
    font-size: 2.2rem;
    margin-bottom: 20px;
  }

  .tabs {
    display: flex;
    justify-content: center;
    background: #2A3F4A;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 25px;
  }

  .tab {
    flex: 1;
    padding: 14px 0;
    text-align: center;
    color: #E0E0E0;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease, color 0.3s ease;
  }

  .tab.active {
    background: #5cb85c;
    color: #fff;
    box-shadow: 0 0 12px rgba(92, 184, 92, 0.6);
  }

  .tab:hover {
    background: #4a9a4a;
    color: #fff;
  }

  .tab-content {
    display: none;
    animation: fadeSlide 0.4s ease;
  }

  .tab-content.active {
    display: block;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #F0F0F0;
  }

  textarea, input[type="file"], input[type="range"] {
    width: 100%;
    background: #2A3F4A;
    color: #F0F0F0;
    border: 1px solid #4a5e6a;
    border-radius: 8px;
    padding: 12px;
    font-size: 15px;
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
  }

  textarea:focus, input[type="file"]:focus, input[type="range"]:focus {
    outline: none;
    border-color: #5cb85c;
  }

  button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    background: #5cb85c;
    color: white;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background: #4a9a4a;
  }

  .secondary-btn {
    background: #17a2b8;
  }

  .secondary-btn:hover {
    background: #138d9e;
  }

  .slider-container {
    margin-top: 20px;
  }

  .slider-labels {
    display: flex;
    justify-content: space-between;
    color: #ccc;
    font-size: 13px;
  }

  .current-value {
    text-align: center;
    color: #E0E0E0;
    margin-top: 5px;
  }

  #loading {
    display: none;
    text-align: center;
    padding: 40px;
    color: #F0F0F0;
  }

  #spinner {
    margin: 25px auto;
    width: 55px;
    height: 55px;
    border: 6px solid rgba(255, 255, 255, 0.2);
    border-top: 6px solid #5cb85c;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes fadeIn { from {opacity: 0; transform: translateY(15px);} to {opacity: 1; transform: translateY(0);} }
  @keyframes fadeSlide { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }
  @keyframes spin { to {transform: rotate(360deg);} }

  a#toggle-advanced, a#toggle-advanced-upload {
    color: #5cb85c;
    text-decoration: none;
    font-size: 0.9em;
  }
</style>

<div class="container">
  <h1>{% if lang == 'russian' %}–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å{% else %}Create a New Course{% endif %}</h1>

  <div class="tabs">
    <div class="tab active" id="open-course-tab">{% if lang == 'russian' %}–û—Ç–∫—Ä—ã—Ç—ã–π –∫—É—Ä—Å{% else %}Open Course{% endif %}</div>
    <div class="tab" id="private-course-tab">{% if lang == 'russian' %}–ß–∞—Å—Ç–Ω—ã–π –∫—É—Ä—Å{% else %}Private Course{% endif %}</div>
  </div>

  <!-- OPEN COURSE TAB -->
  <div class="tab-content active" id="open-course-content">
    <form method="POST" action="{{ url_for('assessment.assessment') }}" id="assessment-form">
      <label for="topic">{% if lang == 'russian' %}–û —á–µ–º –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ —É–∑–Ω–∞—Ç—å?{% else %}What would you like to learn about?{% endif %}</label>
      <textarea id="topic" name="topic" placeholder="{% if lang == 'russian' %}–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã Python...{% else %}E.g. Python decorators, World War II history...{% endif %}" required></textarea>

      <div class="slider-container">
        <label for="knowledge">{% if lang == 'russian' %}–£—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π (0‚Äì100){% else %}How well do you know this topic? (0‚Äì100){% endif %}</label>
        <input id="knowledge" name="knowledge" type="range" min="0" max="100" value="50">
        <div class="slider-labels">
          <span>{% if lang == 'russian' %}–ù–æ–≤–∏—á–æ–∫{% else %}Beginner{% endif %}</span>
          <span>{% if lang == 'russian' %}–°—Ä–µ–¥–Ω–∏–π{% else %}Intermediate{% endif %}</span>
          <span>{% if lang == 'russian' %}–≠–∫—Å–ø–µ—Ä—Ç{% else %}Expert{% endif %}</span>
        </div>
        <div class="current-value" id="slider-value">{% if lang == 'russian' %}–¢–µ–∫—É—â–µ–µ: 50{% else %}Current: 50{% endif %}</div>
      </div>

      <div class="advanced-toggle" style="text-align:right; margin-top:15px;">
        <a href="#" id="toggle-advanced">‚öôÔ∏è {% if lang == 'russian' %}–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏{% else %}Advanced Settings{% endif %}</a>
      </div>

      <div id="advanced-settings" style="display:none; margin-top:15px; background:#2A3F4A; padding:15px; border-radius:8px;">
        <label style="display:flex; align-items:center;">
          <input type="checkbox" id="include_background" name="include_background" value="1" style="margin-right:10px;">
          {% if lang == 'russian' %}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ{% else %}Use my personal background{% endif %}
        </label>
        <p style="font-size:0.85em; color:#a0aec0; margin-left:25px;">
          {% if lang == 'russian' %}–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã: –≤–æ–∑—Ä–∞—Å—Ç, –±–∏–æ–≥—Ä–∞—Ñ–∏—è –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ{% else %}Uses your profile age, bio, and other details{% endif %}
        </p>
      </div>

      <button type="submit" style="margin-top:15px;">
        {% if lang == 'russian' %}–ù–∞—á–∞—Ç—å –æ—Ü–µ–Ω–∫—É{% else %}Start Assessment{% endif %}
      </button>
    </form>
  </div>

  <!-- PRIVATE COURSE TAB -->
  <div class="tab-content" id="private-course-content">
    <form method="POST" action="{{ url_for('file.upload_course') }}" enctype="multipart/form-data" id="upload-form">
      <label for="file">{% if lang == 'russian' %}–í—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª:{% else %}Choose PDF file:{% endif %}</label>
      <input type="file" id="file" name="file" accept=".pdf" required>

      <label for="instructions" style="margin-top:20px;">{% if lang == 'russian' %}–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫ –∫—É—Ä—Å—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):{% else %}Course Instructions (optional):{% endif %}</label>
      <textarea id="instructions" name="instructions" rows="4"
        placeholder="{% if lang == 'russian' %}–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–¥–µ–ª–∞–π—Ç–µ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö{% else %}E.g., Focus on practical examples, add tests after sections{% endif %}"></textarea>

      <div class="advanced-toggle" style="text-align:right; margin-top:15px;">
        <a href="#" id="toggle-advanced-upload">‚öôÔ∏è {% if lang == 'russian' %}–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏{% else %}Advanced Settings{% endif %}</a>
      </div>

      <div id="advanced-settings-upload" style="display:none; margin-top:15px; background:#2A3F4A; padding:15px; border-radius:8px;">
        <label style="display:flex; align-items:center;">
          <input type="checkbox" id="include_background_upload" name="include_background" value="1" style="margin-right:10px;">
          {% if lang == 'russian' %}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ{% else %}Use my personal background{% endif %}
        </label>
        <p style="font-size:0.85em; color:#a0aec0; margin-left:25px;">
          {% if lang == 'russian' %}–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã: –≤–æ–∑—Ä–∞—Å—Ç, –±–∏–æ–≥—Ä–∞—Ñ–∏—è –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ{% else %}Uses your profile age, bio, and other details{% endif %}
        </p>
      </div>

      <button type="submit" class="secondary-btn" style="margin-top:15px;">
        {% if lang == 'russian' %}–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å –∏–∑ —Ñ–∞–π–ª–∞{% else %}Create Course from File{% endif %}
      </button>
    </form>
  </div>
</div>

<div id="loading">
  <p id="loading-text">{% if lang == 'russian' %}üß™ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...{% else %}üß™ Preparing...{% endif %}</p>
  <div id="spinner"></div>
</div>

<script>
  const tabs = document.querySelectorAll('.tab');
  const contents = document.querySelectorAll('.tab-content');
  const slider = document.getElementById('knowledge');
  const valueDisplay = document.getElementById('slider-value');
  const lang = '{{ lang }}';
  const loading = document.getElementById('loading');
  const mainContent = document.querySelector('.container');
  const loadingText = document.getElementById('loading-text');

  tabs.forEach((tab, index) => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      contents[index].classList.add('active');
    });
  });

  if (slider && valueDisplay) {
    slider.addEventListener("input", function () {
      const prefix = lang === 'russian' ? '–¢–µ–∫—É—â–µ–µ: ' : 'Current: ';
      valueDisplay.textContent = prefix + slider.value;
    });
  }

  const toggleAdvanced = document.getElementById('toggle-advanced');
  const advancedSettings = document.getElementById('advanced-settings');
  if (toggleAdvanced && advancedSettings) {
    toggleAdvanced.addEventListener('click', e => {
      e.preventDefault();
      advancedSettings.style.display = advancedSettings.style.display === 'none' ? 'block' : 'none';
    });
  }

  const toggleAdvancedUpload = document.getElementById('toggle-advanced-upload');
  const advancedSettingsUpload = document.getElementById('advanced-settings-upload');
  if (toggleAdvancedUpload && advancedSettingsUpload) {
    toggleAdvancedUpload.addEventListener('click', e => {
      e.preventDefault();
      advancedSettingsUpload.style.display = advancedSettingsUpload.style.display === 'none' ? 'block' : 'none';
    });
  }

  const assessmentForm = document.getElementById('assessment-form');
  const uploadForm = document.getElementById('upload-form');
  const loadingMessages = {
    assessment: {
      russian: 'üß™ –ì–æ—Ç–æ–≤–∏–º –≤–∞—à—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É...',
      english: 'üß™ Preparing your custom assessment...'
    },
    upload: {
      russian: 'üìÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à PDF –∏ —Å–æ–∑–¥–∞–µ–º –∫—É—Ä—Å...',
      english: 'üìÑ Processing your PDF and creating course...'
    }
  };

  assessmentForm?.addEventListener('submit', () => {
    loadingText.textContent = lang === 'russian' ? loadingMessages.assessment.russian : loadingMessages.assessment.english;
    mainContent.style.display = 'none';
    loading.style.display = 'block';
  });

  uploadForm?.addEventListener('submit', () => {
    loadingText.textContent = lang === 'russian' ? loadingMessages.upload.russian : loadingMessages.upload.english;
    mainContent.style.display = 'none';
    loading.style.display = 'block';
  });
</script>

{% endblock %}
