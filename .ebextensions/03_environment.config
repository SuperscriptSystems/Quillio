option_settings:
  aws:elasticbeanstalk:application:environment:
    # Database configuration
    DATABASE_URL: "postgresql://postgres:Quillio#aws1@quillio.ctyhtso2qejb.us-east-1.rds.amazonaws.com:5432/postgres"
    
    # Flask configuration
    SECRET_KEY: "wdsadwfioji2ihhhdfuiah82"
    FLASK_ENV: "production"
    
    # Set this to ensure proper database URL parsing
    SQLALCHEMY_DATABASE_URI: "postgresql://postgres:Quillio#aws1@quillio.ctyhtso2qejb.us-east-1.rds.amazonaws.com:5432/postgres"
    
    # Disable SQLAlchemy track modifications to suppress warning
    SQLALCHEMY_TRACK_MODIFICATIONS: "False"

# Install PostgreSQL client
packages:
  yum:
    postgresql: []

# Commands to run after the application is deployed
container_commands:
  01_wait_for_db:
    command: |
      #!/bin/bash
      # This script will wait for the database to be available
      until PGPASSWORD="Quillio#aws1" psql -h "quillio.ctyhtso2qejb.us-east-1.rds.amazonaws.com" -U "postgres" -d "postgres" -c "SELECT 1" > /dev/null 2>&1; do
        echo "Waiting for database to be ready..."
        sleep 5
      done
      echo "Database is ready!"
    leader_only: true
